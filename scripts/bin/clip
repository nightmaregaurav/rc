#!/usr/bin/env -S uv run --script

# /// script
# requires-python = ">=3.14"
# dependencies = [
# ]
# ///

import os
import sys
import platform
import subprocess

script_name = os.path.basename(sys.argv[0])

HELP_MSG = f"""Usage: {script_name} [text]

Copy text to the clipboard or paste from it.

Examples:
  {script_name} "Hello, World!"   # Copy to clipboard
  {script_name}                    # Paste from clipboard
"""

# Show help
if len(sys.argv) > 1 and sys.argv[1] in ("--help", "-h"):
    print(HELP_MSG)
    sys.exit(0)

text_to_copy = " ".join(sys.argv[1:]) if len(sys.argv) > 1 else None
os_type = platform.system()


def copy_to_clipboard(text):
    if os_type == "Darwin":
        subprocess.run("pbcopy", input=text.encode())
    elif os_type == "Linux":
        try:
            subprocess.run(["xclip", "-selection", "clipboard"], input=text.encode())
        except FileNotFoundError:
            print("Error: 'xclip' not installed.")
            sys.exit(1)
    elif os_type == "Windows":
        subprocess.run(["powershell", "-Command", "Set-Clipboard"], input=text.encode())
    else:
        print("Error: Clipboard functionality not supported on this platform.")
        sys.exit(1)


def paste_from_clipboard():
    if os_type == "Darwin":
        result = subprocess.run(["pbpaste"], capture_output=True, text=True)
        print(result.stdout, end="")
    elif os_type == "Linux":
        try:
            result = subprocess.run(
                ["xclip", "-selection", "clipboard", "-o"],
                capture_output=True,
                text=True,
            )
            print(result.stdout, end="")
        except FileNotFoundError:
            print("Error: 'xclip' not installed.")
            sys.exit(1)
    elif os_type == "Windows":
        result = subprocess.run(
            ["powershell", "-Command", "Get-Clipboard"], capture_output=True, text=True
        )
        print(result.stdout, end="")
    else:
        print("Error: Clipboard functionality not supported on this platform.")
        sys.exit(1)


if text_to_copy:
    copy_to_clipboard(text_to_copy)
else:
    paste_from_clipboard()

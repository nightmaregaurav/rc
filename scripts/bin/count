#!/usr/bin/env -S uv run --script

# /// script
# requires-python = ">=3.14"
# dependencies = [
#   "argcomplete",
# ]
# ///

import os
import sys
import fnmatch
import argparse
import argcomplete

script_name = os.path.basename(sys.argv[0])


def count_entries(pattern: str = "*"):
    """Count files and folders in the current directory (no recursion)."""
    entries = os.listdir(".")
    files = [f for f in entries if os.path.isfile(f)]
    folders = [d for d in entries if os.path.isdir(d)]

    matching_files = [f for f in files if fnmatch.fnmatch(f, pattern)]
    matching_folders = [d for d in folders if fnmatch.fnmatch(d, pattern)]

    print(f"Total: {len(files) + len(folders)}")
    print(f"Folders: {len(folders)}")
    print(f"Files: {len(files)}")

    if pattern != "*":
        print(f"{pattern}: {len(matching_files)} files, {len(matching_folders)} folders")


def complete_flags(prefix, parsed_args, **_):
    """Autocomplete available flags."""
    return [opt for opt in ("-h", "--help") if opt.startswith(prefix)]


def main():
    parser = argparse.ArgumentParser(
        prog=script_name,
        description="Count files and folders in the current directory (no subdirectories).",
        epilog=(
            f"Examples:\n"
            f"  {script_name}           # Count all files and folders\n"
            f"  {script_name} '*.pdf'   # Count and filter matching *.pdf files"
        ),
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=False,
    )

    parser.add_argument(
        "pattern",
        nargs="?",
        default="*",
        help="Optional pattern to match files and folders (default: '*').",
    )

    parser.add_argument(
        "-h", "--help",
        action="help",
        help="Show help message and exit."
    )

    argcomplete.autocomplete(parser, always_complete_options=False)
    args = parser.parse_args()

    count_entries(args.pattern)


if __name__ == "__main__":
    main()

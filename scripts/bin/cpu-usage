#!/usr/bin/env -S uv run --script

# /// script
# requires-python = ">=3.14"
# dependencies = [
#   "psutil",
#   "argcomplete",
# ]
# ///

import sys
import argparse
import argcomplete
import psutil

script_name = "cpu-usage"


def get_cpu_usage() -> float:
    """Return average CPU usage percentage over a short interval."""
    return psutil.cpu_percent(interval=0.5)


def complete_flags(prefix, parsed_args, **_):
    """Autocomplete available flags."""
    return [opt for opt in ("-h", "--help") if opt.startswith(prefix)]


def main():
    parser = argparse.ArgumentParser(
        prog=script_name,
        description="Show the current CPU usage in percentage.",
        epilog=f"Examples:\n  {script_name}",
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=False,
    )

    parser.add_argument(
        "-h", "--help",
        action="help",
        help="Show help message and exit.",
    )

    argcomplete.autocomplete(parser, always_complete_options=False)
    parser.parse_args()

    print(f"{get_cpu_usage():.1f}")


if __name__ == "__main__":
    main()

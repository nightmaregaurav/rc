#!/usr/bin/env -S uv run --script

# /// script
# requires-python = ">=3.14"
# dependencies = [
#     "argcomplete",
# ]
# ///

import os
import sys
import argparse
import argcomplete


def create_and_enter_directory(directory: str):
    """Create a directory and change into it if possible."""
    try:
        os.makedirs(directory, exist_ok=True)
        os.chdir(directory)
    except Exception as e:
        print(f"Error: {e}")
        sys.exit(1)


def main():
    parser = argparse.ArgumentParser(
        description="Create a directory and change into it (if run in an interactive shell).",
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=False,
    )

    parser.add_argument(
        "directory",
        nargs="?",
        help="Directory name to create and switch to.",
    )

    parser.add_argument(
        "-h", "--help",
        action="help",
        help="Show help message and exit.",
    )

    argcomplete.autocomplete(parser, always_complete_options=False)
    args = parser.parse_args()

    if not args.directory:
        print("Error: missing directory name.")
        sys.exit(1)

    create_and_enter_directory(args.directory)


if __name__ == "__main__":
    main()

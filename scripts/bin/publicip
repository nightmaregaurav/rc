#!/usr/bin/env -S uv run --script

# /// script
# requires-python = ">=3.14"
# dependencies = [
#     "argcomplete",
# ]
# ///

import os
import sys
import urllib.request
import socket
import ipaddress
import argparse
import argcomplete


def fetch_public_ip() -> str:
    urls = [
        "https://ifconfig.io/ip",
        "https://ifconfig.me/ip",
        "https://api.ipify.org",
        "https://icanhazip.com",
    ]

    for url in urls:
        try:
            with urllib.request.urlopen(url, timeout=3) as response:
                candidate = response.read().decode().strip()
                try:
                    ip = ipaddress.ip_address(candidate)
                    return str(ip)
                except ValueError:
                    continue
        except (urllib.error.URLError, socket.timeout):
            continue

    return "0.0.0.0"




def main():
    parser = argparse.ArgumentParser(
        description="Fetch the public IP address.",
        formatter_class=argparse.RawTextHelpFormatter,
        add_help=False,
    )

    parser.add_argument(
        "-h", "--help",
        action="help",
        help="Show help message and exit.",
    )

    argcomplete.autocomplete(parser, always_complete_options=False)
    parser.parse_args()

    print(fetch_public_ip())


if __name__ == "__main__":
    main()

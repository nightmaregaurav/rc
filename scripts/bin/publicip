#!/usr/bin/env bash

# Help message
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  echo "Usage: publicip"
  echo
  echo "Fetches the public IP address."
  echo
  echo "Examples:"
  echo "  publicip"
  exit 0
fi

# Fetch the public IP using multiple fallbacks
addr=$(
  timeout 3 curl -s http://whatismyip.akamai.com/ || \
  timeout 3 curl -s http://ifconfig.io/ip || \
  timeout 3 curl -s http://ifconfig.me/ip || \
  timeout 3 curl -s http://ipecho.net/plain
)

# Fallback if all fail
[ $? -ne 0 ] && addr="0.0.0.0"

# Validate and show
if [[ "$addr" =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}$ || "$addr" =~ ^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$ ]]; then
  echo "$addr"
fi

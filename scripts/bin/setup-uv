#!/usr/bin/env bash

SCRIPT=$(basename "$0")

HELP_MESSAGE="Usage: $SCRIPT
Installs uv, An extremely fast Python package and project manager.

Examples:
  $SCRIPT"

# Help message
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  echo "$HELP_MESSAGE"
  exit 0
fi

set -e  # Exit immediately if a command exits with a non-zero status

echo "Detecting operating system..."

OS="$(uname -s)"

case "$OS" in
    Darwin)
        echo "Detected macOS."
        if ! command -v brew >/dev/null 2>&1; then
            echo "Homebrew not found. Please install Homebrew first: https://brew.sh/"
            exit 1
        fi
        echo "Installing uv with Homebrew..."
        brew install uv
        ;;

    Linux)
        # if $TERMUX_VERSION env var is set it's Amdroid(termux)
        if [[ -n "$TERMUX_VERSION" ]]; then
            echo "Detected Android(termux)."
            echo "Installing uv with pkg..."
            pkg install uv
        else
            echo "Detected Linux."
            echo "Installing uv with curl..."
            curl -LsSf https://astral.sh/uv/install.sh | sh
        fi
        ;;

    MINGW*|MSYS*|CYGWIN*|Windows_NT)
        echo "Detected Windows."
        if ! command -v winget >/dev/null 2>&1; then
            echo "winget not found. Please make sure you're running this in a Windows environment with winget available."
            exit 1
        fi
        echo "Installing uv with winget..."
        winget install --id=astral-sh.uv -e --source winget
        ;;

    *)
        echo "Unsupported OS: $OS"
        exit 1
        ;;
esac

uv python install 3.14
uv python install 3.13
uv tool install argcomplete

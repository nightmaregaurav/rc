#!/usr/bin/env bash

SCRIPT=$(basename "$0")

HELP_MESSAGE="Usage: $SCRIPT <remote-hostname>
Runs the snap-camera command on the remote machine and copies the captured file(s) to local Downloads.

Example:
  $SCRIPT my-remote-host"

# Help message
if [[ "$1" == "--help" || "$1" == "-h" ]]; then
  echo "$HELP_MESSAGE"
  exit 0
fi

set -e  # Exit immediately if a command exits with a non-zero status

remote="$1"

if [ -z "$remote" ]; then
  echo "Usage: $SCRIPT <remote-hostname>"
  exit 1
fi

# Run the snap-camera command on the remote machine
ssh "$remote" "bash -c '~/Repositories/rc/scripts/bin/snap-camera -d ~/Capture.png'"

# Copy the captured file(s) to local Downloads
scp "$remote:~/Capture*.png" ~/Downloads/

# Clean up the remote file(s)
ssh "$remote" "bash -c 'rm ~/Capture*.png'"
